# REAPER Autopilot v2 — бит + вокал (сведение и мастеринг)

Скрипт `reaper_autopilot.lua` строит рабочую сессию под загруженный бит и многоуровневый вокал,
исходя из анализа предоставленных стемов. Он автоматически организует треки, добавляет цепочки FX,
настраивает посылы (реверб, слэп-делей, параллельная компрессия), мастер-обработку и пресет рендера на 45 секунд.

## Результаты анализа стемов
| Стем | Продолжительность | Пик | RMS | Динамический диапазон (5–95%) | Сред. спектральный центроид | Диапазоны энергии |
|------|-------------------|-----|-----|-------------------------------|-----------------------------|--------------------|
| Бит (`120.8s Recording…`) | 1:59.96 @ 48 кГц | −4.31 dBFS | −16.85 dBFS | 9.46 dB | 3.44 кГц | Sub 7.9 %, 60–120 Гц 6.3 %, 500–2 кГц 22.9 %, 2–6 кГц 17.3 %, 6–12 кГц 17.7 % |
| Референс вокала (`Хорошо сведенная`) | 0:04.58 @ 44.1 кГц | −48.16 dBFS | −55.35 dBFS | 3.19 dB | 11.0 кГц | 2–6 кГц 19.8 %, 6–12 кГц 29.2 %, 12–20 кГц 41.1 % |

**Что это значит для микса**
- Бит уже имеет упругий саб/бас, но много энергии в 3–6 кГц и верхах → добавлена лёгкая
  коррекция ReaEQ, чтобы освободить место под вокал и смягчить резкость.
- Референс вокала очень воздушный, с фокусом выше 6 кГц и малой громкостью → вокальным цепочкам
  заданы два каскада компрессии, де-эссер на ~6.2 кГц, лёгкая сатурация и подъём присутствия 2.8–3.2 кГц.
- Итоговая цель по мастер-шине: RMS ≈ −11…−10 dBFS, пики ≤ −1 dBTP, 48 кГц / 24‑бит WAV.

## Что делает скрипт v2
- Переименовывает первый выделенный (или просто первый) трек в **Beat – Instrumental**, добавляет
  ReaEQ, ReaComp и JS Saturation с настройками под обнаруженный тональный баланс, расширяет трек до 4 каналов для сайдчейна.
- Для последующих треков создаёт слоты: `Lead Main`, `Lead Double L/R`, `Back Vox L/R`, `Air Vox L/R` с индивидуальными
  панорамами/уровнями и полной вокальной цепочкой (ReaEQ → два ReaComp → JS De-esser → JS Saturation → ReaDelay).
- Создаёт шины `Vocal Bus`, `Vox Verb Aux`, `Vox Delay Aux`, `Parallel Crush`, `Mix Bus`, `Master Print`, а также
  `Reference (mute to compare)` без посыла на мастер.
- Выстраивает маршрутизацию: вокал → Vocal Bus (+реверб/делей, параллельный компрессор), Beat и Vocal Bus → Mix Bus → Master.
  Beat дополнительно посылается в вокальные треки на каналы 3/4 для управления компрессией.
- Настраивает рендер: 0–45 секунд, WAV 24‑бит, 48 кГц, лимитер `JS: Master Limiter` с потолком −1 dBTP.

## Подготовка и запуск
1. **Разложи стемы.** Помести бит на первый трек проекта, вокальные дорожки (лид, даблы, бэки, эйры) — на следующие.
   Можно выделить только нужные треки перед запуском; если выделения нет, скрипт возьмёт все по порядку.
2. **Подгрузи скрипт.** В REAPER открой `Actions List` → `ReaScript` → `Load`, укажи `reaper_autopilot.lua` и добавь его в список действий.
3. **Запусти.** Выполни скрипт. Он переименует треки, проставит FX, создаст шины и сенды, подготовит мастер.
4. **A/B с референсом.** Перетащи эталонный микс на трек `Reference (mute to compare)` — он обходит мастер, но имеет метринг.
5. **Контроль.** Проверь уровни посылов (`Vox Verb Aux`, `Vox Delay Aux`, `Parallel Crush`), откорректируй, если нужно. Лимитер на мастере уже удерживает пики.
6. **Рендер.** Используй `File: Render project, using the most recent render settings` для 45‑секундной версии. При необходимости измени диапазон/формат и повтори запуск.

## Что дальше можно автоматизировать
- Добавить хранение вкусовых профилей (например, JSON с целевыми цветами тембра/ширины) и подменять параметры EQ/компрессии.
- Подключить сторонние плагины: замени названия FX в коде на свои (FabFilter, Ozone и т. п.) или вставь кастомные цепочки через `TrackFX_AddByName`.
- Развернуть дополнительный анализ: скрипт уже ставит `JS: Loudness Meter` на Mix Bus и Reference — можно считать LUFS/динамику и подстраивать уровни автоматически.
- Для финального мастеринга расширить Master-шину мультибенд-компрессором, аналоговым клоном, Mid/Side‑EQ или автоматическим экспортом stem/instrumental.

Если замечаешь несоответствия (например, не та частота сайдчейна или нужна иная длина рендера), дай обратную связь — параметры легко обновляются в одном месте.
